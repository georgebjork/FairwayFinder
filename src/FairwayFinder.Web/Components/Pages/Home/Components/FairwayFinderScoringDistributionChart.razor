@using FairwayFinder.Features.Data

@if (Distribution is null || Distribution.TotalHoles == 0)
{
    <RadzenStack AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center" Style="min-height: 300px;">
        <RadzenText TextStyle="TextStyle.Body2" style="color: var(--rz-text-secondary-color);">
            No scoring data available yet.
        </RadzenText>
    </RadzenStack>
}
else
{
    <RadzenChart Style="height: 300px;">
        <RadzenDonutSeries Data="@_chartData" 
                           CategoryProperty="Category" 
                           ValueProperty="Count"
                           Fills="@_colors"
                           Title="Scoring">
            <TitleTemplate>
                <div class="rz-donut-content">
                    <div style="font-size: 1.5rem; font-weight: 600; line-height: 1.2;">@Distribution.TotalHoles</div>
                    <div style="font-size: 0.75rem; color: var(--rz-text-secondary-color);">holes</div>
                </div>
            </TitleTemplate>
            <TooltipTemplate Context="data">
                <div class="rz-p-2">
                    <RadzenText TextStyle="TextStyle.Subtitle2" class="rz-mb-1">@data.Category</RadzenText>
                    <RadzenText TextStyle="TextStyle.Body2">
                        <strong>@data.Count</strong> holes (@(((double)data.Count / Distribution.TotalHoles * 100).ToString("F1"))%)
                    </RadzenText>
                </div>
            </TooltipTemplate>
        </RadzenDonutSeries>
        <RadzenLegend Position="LegendPosition.Right" />
    </RadzenChart>
}

@code {
    [Parameter]
    public ScoringDistribution? Distribution { get; set; }

    private List<ScoringChartItem>? _chartData;
    
    // Colors: Eagles (dark green), Birdies (green), Pars (blue), Bogeys (orange), Double+ (red)
    private string[] _colors = new[]
    {
        "#1b5e20", // Eagles (dark green)
        "#4caf50", // Birdies (green)
        "#2196f3", // Pars (blue)
        "#ff9800", // Bogeys (orange)
        "#f44336", // Double Bogeys (red)
        "#b71c1c"  // Triple+ (dark red)
    };

    protected override void OnParametersSet()
    {
        if (Distribution is not null && Distribution.TotalHoles > 0)
        {
            // Build chart data - combine rare categories (hole-in-one, double eagle) with eagles
            var eaglesTotal = Distribution.HolesInOne + Distribution.DoubleEagles + Distribution.Eagles;
            
            _chartData = new List<ScoringChartItem>();
            
            if (eaglesTotal > 0)
                _chartData.Add(new ScoringChartItem { Category = "Eagles", Count = eaglesTotal });
            if (Distribution.Birdies > 0)
                _chartData.Add(new ScoringChartItem { Category = "Birdies", Count = Distribution.Birdies });
            if (Distribution.Pars > 0)
                _chartData.Add(new ScoringChartItem { Category = "Pars", Count = Distribution.Pars });
            if (Distribution.Bogeys > 0)
                _chartData.Add(new ScoringChartItem { Category = "Bogeys", Count = Distribution.Bogeys });
            if (Distribution.DoubleBogeys > 0)
                _chartData.Add(new ScoringChartItem { Category = "Double Bogeys", Count = Distribution.DoubleBogeys });
            if (Distribution.TripleOrWorse > 0)
                _chartData.Add(new ScoringChartItem { Category = "Triple+", Count = Distribution.TripleOrWorse });
        }
    }

    private class ScoringChartItem
    {
        public string Category { get; set; } = string.Empty;
        public int Count { get; set; }
    }
}
